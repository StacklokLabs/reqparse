upstream ollama {
    server               localhost:11434;
}
# Server block for HTTPS traffic (port 443)
server {
    listen 443 ssl;
    server_name inference.codegate.ai;

    # SSL configuration - managed by Let's Encrypt
    ssl_certificate /etc/letsencrypt/live/inference.codegate.ai/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/inference.codegate.ai/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

    # New location with streaming
    location / {

        set $token "Bearer 79df4babd4d8b62b5816c1fd7dbb7c7b23a2508630e48cc99be3966a8b855e27";
        if ($http_authorization != $token) {
            return 401 "Unauthorized";
        }

        proxy_set_header  Host "localhost";
        proxy_set_header  X-Real-IP "127.0.0.1";
        proxy_set_header  X-Forwarded-For "127.0.0.1";
        proxy_set_header  X-Forwarded-Proto $scheme;
        proxy_pass http://127.0.0.1:11434;
    }
}